<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .required-field {
            border-left: 3px solid #ef4444;
        }

        .field-error {
            border: 2px solid #ef4444 !important;
            background-color: #fef2f2 !important;
        }
        
        .incomplete-notes {
            transition: all 0.3s ease;
        }

        
        .notification {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 10px;
            padding: 16px;
            transform: translateX(400px);
            transition: all 0.3s ease-in-out;
            border-left: 4px solid;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
        }

        .notification.error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2 0%, #fef7f7 100%);
        }

        .notification.warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, #fffbeb 0%, #fefce8 100%);
        }

        .notification.info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #f0f9ff 100%);
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .notification.success .notification-icon {
            background: #10b981;
        }

        .notification.error .notification-icon {
            background: #ef4444;
        }

        .notification.warning .notification-icon {
            background: #f59e0b;
        }

        .notification.info .notification-icon {
            background: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50"></div>
    
    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ -->
    <div class="p-6">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>
                <div class="text-gray-600">
                    <p><strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> <span id="employeeName">Ø§Ù…ÙŠØ± </span></p>
                    <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span id="currentDate"></span></p>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 card-hover">
            <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                <i class="fas fa-users ml-2"></i>
                Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-red-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ÙŠÙˆÙ… <span class="text-red-500">*</span></label>
                    <input type="number" id="expiredTodaySubscriptions" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…ÙØ¹Ù„Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="activeSubscriptions" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ù… ÙŠØ³ØªÙ‚Ø¨Ù„ÙˆØ§ Ø§Ù„Ø§ØªØµØ§Ù„ <span class="text-red-500">*</span></label>
                    <input type="number" id="noAnswerSubscribers" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙŠØ¹Ø§ÙˆØ¯ÙˆÙ† Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ø§Ø­Ù‚Ø§Ù‹ <span class="text-red-500">*</span></label>
                    <input type="number" id="callBackLaterSubscribers" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ø§Ù„Ø²ÙˆÙ†Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 card-hover">
            <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                <i class="fas fa-phone ml-2"></i>
                Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ø§Ù„Ø²ÙˆÙ†Ø§Øª Ø§Ù„Ù†Ù‚Ø¯
            </h3>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ø§Ù„Ø²ÙˆÙ†Ø§Øª Ø§Ù„Ù†Ù‚Ø¯ <span class="text-red-500">*</span></label>
                <textarea id="cashZonesNotes" class="w-full p-2 border rounded-lg required-field" rows="4" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ø§Ù„Ø²ÙˆÙ†Ø§Øª Ø§Ù„Ù†Ù‚Ø¯..." required></textarea>
            </div>
        </div>

        <!-- Ø§Ù„ØµÙŠØ§Ù†Ø§Øª -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 card-hover">
            <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                <i class="fas fa-tools ml-2"></i>
                Ø§Ù„ØµÙŠØ§Ù†Ø§Øª
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="incomingMaintenance" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="completedMaintenance" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø¬Ù„Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="postponedMaintenance" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" onchange="togglePostponedNotes()" required>
                </div>
            </div>
            
            <!-- Ù…Ø±Ø¨Ø¹ Ø³Ø¨Ø¨ Ø§Ù„ØªØ£Ø¬ÙŠÙ„ -->
            <div id="postponedNotesSection" class="hidden mb-4">
                <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø°ÙƒØ± Ø³Ø¨Ø¨ Ø§Ù„ØªØ£Ø¬ÙŠÙ„ <span class="text-red-500">*</span></label>
                    <textarea id="postponedNotes" class="w-full p-2 border rounded-lg required-field" rows="3" placeholder="Ø§Ø°ÙƒØ± Ø£Ø³Ø¨Ø§Ø¨ ØªØ£Ø¬ÙŠÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª..." required></textarea>
                </div>
            </div>
            
            <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª -->
            <div class="bg-gray-50 p-4 rounded-lg">
                <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª</label>
                <textarea id="maintenanceGeneralNotes" class="w-full p-2 border rounded-lg" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø§Ù„Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª..."></textarea>
            </div>
        </div>

        <!-- Ø§Ù„ØªØ°Ø§ÙƒØ± -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 card-hover">
            <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                <i class="fas fa-ticket-alt ml-2"></i>
                Ø§Ù„ØªØ°Ø§ÙƒØ± (Tickets)
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„ÙˆØ§Ø±Ø¯Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="incomingTickets" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ù…ÙØªÙˆØ­Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="openTickets" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„ØªØ°Ø§ÙƒØ±</label>
                <textarea id="ticketsNotes" class="w-full p-2 border rounded-lg" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„ØªØ°Ø§ÙƒØ±..."></textarea>
            </div>
        </div>

        <!-- Ø§Ù„ØªÙ†ØµÙŠØ¨Ø§Øª -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 card-hover">
            <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                <i class="fas fa-network-wired ml-2"></i>
                Ø§Ù„ØªÙ†ØµÙŠØ¨Ø§Øª
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ†ØµÙŠØ¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="incomingInstallations" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØªÙ†ØµÙŠØ¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© <span class="text-red-500">*</span></label>
                    <input type="number" id="completedInstallations" class="w-full p-2 border rounded-lg required-field" placeholder="0" min="0" required>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© <span class="text-red-500">*</span></label>
                    <select id="serviceType" class="w-full p-2 border rounded-lg required-field" required>
                        <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</option>
                        <option value="FTTH">ftth</option>
                        <option value="ÙˆØ§ÙŠØ±Ù„ÙŠØ³">ÙˆØ§ÙŠØ±Ù„ÙŠØ³</option>
                        <option value="ÙƒÙ„Ø§Ù‡Ù…Ø§">ÙƒÙ„Ø§Ù‡Ù…Ø§</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„ØªÙ†ØµÙŠØ¨Ø§Øª</label>
                    <textarea id="installationsNotes" class="w-full p-2 border rounded-lg h-[50px]" rows="3" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ø­ÙˆÙ„ Ø§Ù„ØªÙ†ØµÙŠØ¨Ø§Øª..."></textarea>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„ØªÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6 card-hover">
            <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                <i class="fas fa-users-cog ml-2"></i>
                Ø§Ù„ØªÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            </h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©</label>
                <select id="addType" class="w-full p-2 border rounded-lg" onchange="toggleAddType()">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                    <option value="employee">Ù…ÙˆØ¸Ù</option>
                    <option value="team">ØªÙŠÙ…</option>
                </select>
            </div>

            <div id="workItemsList" class="space-y-4">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„ØªÙŠÙ… Ù‡Ù†Ø§ -->
            </div>

            <div class="mt-4 space-x-2 space-x-reverse">
                <button id="addEmployeeBtn" onclick="addEmployee()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 hidden">
                    <i class="fas fa-user-plus ml-1"></i>
                    Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
                </button>
                <button id="addTeamBtn" onclick="addTeam()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 hidden">
                    <i class="fas fa-users ml-1"></i>
                    Ø¥Ø¶Ø§ÙØ© ØªÙŠÙ…
                </button>
            </div>
        </div>

        <!-- Ø²Ø± Ø§Ù„Ø­ÙØ¸ -->
        <div class="text-center">
            <button onclick="saveReport()" class="bg-green-600 text-white px-8 py-3 rounded-lg text-lg font-semibold hover:bg-green-700 transition-colors">
                <i class="fas fa-save ml-2"></i>
                Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            </button>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ
        let editingReportId = null;
        let maintenanceEmployees = [];
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (currentUser) {
                document.getElementById('employeeName').textContent = currentUser.name;
                document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ar-EG');
                loadMaintenanceEmployees();
            } else {
                window.location.href = 'login.html';
            }
        });
        
        // ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ¸ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©
        function loadMaintenanceEmployees() {
            try {
                const savedEmployees = localStorage.getItem('maintenanceEmployees');
                if (savedEmployees) {
                    maintenanceEmployees = JSON.parse(savedEmployees);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ¸ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©:', error);
                maintenanceEmployees = [];
            }
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        function toggleAddType() {
            const addType = document.getElementById('addType').value;
            const addEmployeeBtn = document.getElementById('addEmployeeBtn');
            const addTeamBtn = document.getElementById('addTeamBtn');
            
            if (addType === 'employee') {
                addEmployeeBtn.classList.remove('hidden');
                addTeamBtn.classList.add('hidden');
            } else if (addType === 'team') {
                addEmployeeBtn.classList.add('hidden');
                addTeamBtn.classList.remove('hidden');
            } else {
                addEmployeeBtn.classList.add('hidden');
                addTeamBtn.classList.add('hidden');
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
        function addEmployee() {
            const workItemsList = document.getElementById('workItemsList');
            const employeeId = 'employee_' + Date.now();
            const newEmployee = document.createElement('div');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ù…ÙˆØ¸ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©
            let employeesOptions = '<option value="">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</option>';
            maintenanceEmployees.forEach(employee => {
                employeesOptions += `<option value="${employee}">${employee}</option>`;
            });
            
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯ ', 'success');
            newEmployee.className = 'bg-green-50 p-4 rounded-lg border-2 border-green-200 work-item';
            newEmployee.setAttribute('data-type', 'employee');
            newEmployee.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-semibold text-green-800 flex items-center">
                        <i class="fas fa-user ml-2"></i>
                        Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
                    </h4>
                    <button onclick="removeWorkItem(this)" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù <span class="text-red-500">*</span></label>
                        <select class="w-full p-2 border rounded-lg employee-name required-field" required>
                            ${employeesOptions}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆØ¸Ù <span class="text-red-500">*</span></label>
                        <select class="w-full p-2 border rounded-lg employee-rating required-field" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
                            <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø²</option>
                            <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
                            <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
                            <option value="Ù…Ù‚Ø¨ÙˆÙ„">Ù…Ù‚Ø¨ÙˆÙ„</option>
                            <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
                        </select>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© <span class="text-red-500">*</span></label>
                        <input type="number" class="w-full p-2 border rounded-lg maintenance-incoming required-field" placeholder="0" min="0" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© <span class="text-red-500">*</span></label>
                        <input type="number" class="w-full p-2 border rounded-lg maintenance-completed required-field" placeholder="0" min="0" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© <span class="text-red-500">*</span></label>
                        <input type="number" class="w-full p-2 border rounded-lg maintenance-incomplete required-field" placeholder="0" min="0" onchange="toggleIncompleteNotes(this)" required>
                    </div>
                </div>

                <div class="incomplete-notes hidden mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© (Ø§Ø°ÙƒØ± Ø§Ù„Ø³Ø¨Ø¨) <span class="text-red-500">*</span></label>
                    <textarea class="w-full p-2 border rounded-lg maintenance-notes required-field" rows="2" placeholder="Ø§Ø°ÙƒØ± Ø£Ø³Ø¨Ø§Ø¨ Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª..." required></textarea>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2"> Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©</label>
                        <textarea class="w-full p-2 border rounded-lg cables-outgoing-notes" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2"> Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</label>
                        <textarea class="w-full p-2 border rounded-lg cables-incoming-notes" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©..."></textarea>
                    </div>
                </div>
            `;
            workItemsList.appendChild(newEmployee);
        }
        
        // Ø¥Ø¶Ø§ÙØ© ØªÙŠÙ… Ø¬Ø¯ÙŠØ¯
        function addTeam() {
            const workItemsList = document.getElementById('workItemsList');
            const teamId = 'team_' + Date.now();
            const newTeam = document.createElement('div');
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ ØªÙŠÙ… Ø¬Ø¯ÙŠØ¯ ', 'success');
            newTeam.className = 'bg-blue-50 p-4 rounded-lg border-2 border-blue-200 work-item';
            newTeam.setAttribute('data-type', 'team');
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ù…ÙˆØ¸ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©
            let employeesOptions = '<option value="">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</option>';
            maintenanceEmployees.forEach(employee => {
                employeesOptions += `<option value="${employee}">${employee}</option>`;
            });
            
            newTeam.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-semibold text-blue-800 flex items-center">
                        <i class="fas fa-users ml-2"></i>
                        ØªÙŠÙ… Ø¬Ø¯ÙŠØ¯
                    </h4>
                    <button onclick="removeWorkItem(this)" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„ØªÙŠÙ… (Ø£Ù‚Ù„ Ø¹Ø¯Ø¯: 2) <span class="text-red-500">*</span></label>
                    <div class="team-members space-y-2">
                        <select class="w-full p-2 border rounded-lg member-name required-field" required>
                            ${employeesOptions}
                        </select>
                        <select class="w-full p-2 border rounded-lg member-name required-field" required>
                            ${employeesOptions}
                        </select>
                    </div>
                    <button type="button" onclick="addTeamMember(this)" class="mt-2 text-blue-600 hover:text-blue-800">
                        <i class="fas fa-plus ml-1"></i>
                        Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¢Ø®Ø±
                    </button>
                </div>

                <button type="button" onclick="confirmTeam(this)" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 mb-4">
                    <i class="fas fa-check ml-1"></i>
                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙŠÙ…
                </button>

                <div class="team-details hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªÙŠÙ… <span class="text-red-500">*</span></label>
                            <select class="w-full p-2 border rounded-lg team-rating required-field" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</option>
                                <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø²</option>
                                <option value="Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹">Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹</option>
                                <option value="Ø¬ÙŠØ¯">Ø¬ÙŠØ¯</option>
                                <option value="Ù…Ù‚Ø¨ÙˆÙ„">Ù…Ù‚Ø¨ÙˆÙ„</option>
                                <option value="Ø¶Ø¹ÙŠÙ">Ø¶Ø¹ÙŠÙ</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© <span class="text-red-500">*</span></label>
                            <input type="number" class="w-full p-2 border rounded-lg maintenance-incoming required-field" placeholder="0" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© <span class="text-red-500">*</span></label>
                            <input type="number" class="w-full p-2 border rounded-lg maintenance-completed required-field" placeholder="0" min="0" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© <span class="text-red-500">*</span></label>
                            <input type="number" class="w-full p-2 border rounded-lg maintenance-incomplete required-field" placeholder="0" min="0" onchange="toggleIncompleteNotes(this)" required>
                        </div>
                    </div>

                    <div class="incomplete-notes hidden mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© (Ø§Ø°ÙƒØ± Ø§Ù„Ø³Ø¨Ø¨) <span class="text-red-500">*</span></label>
                        <textarea class="w-full p-2 border rounded-lg maintenance-notes required-field" rows="2" placeholder="Ø§Ø°ÙƒØ± Ø£Ø³Ø¨Ø§Ø¨ Ø¹Ø¯Ù… Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª..." required></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2"> Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©</label>
                            <textarea class="w-full p-2 border rounded-lg cables-outgoing-notes" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ØµØ§Ø¯Ø±Ø©..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2"> Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</label>
                            <textarea class="w-full p-2 border rounded-lg cables-incoming-notes" rows="3" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙƒÙŠØ¨Ù„Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©..."></textarea>
                        </div>
                    </div>
                </div>
            `;
            workItemsList.appendChild(newTeam);
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙØ±ÙŠÙ‚
        function addTeamMember(button) {
            const teamMembers = button.previousElementSibling;
            const newMember = document.createElement('select');
            newMember.className = 'w-full p-2 border rounded-lg member-name';
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù†Ø³Ø¯Ù„Ø© Ø¨Ø£Ø³Ù…Ø§Ø¡ Ù…ÙˆØ¸ÙÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø©
            let employeesOptions = '<option value="">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</option>';
            maintenanceEmployees.forEach(employee => {
                employeesOptions += `<option value="${employee}">${employee}</option>`;
            });
            
            newMember.innerHTML = employeesOptions;
            teamMembers.appendChild(newMember);
        }
        
        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙŠÙ…
        function confirmTeam(button) {
            const teamItem = button.closest('.work-item');
            const memberInputs = teamItem.querySelectorAll('.member-name');
            const filledMembers = Array.from(memberInputs).filter(input => input.value.trim() !== '');
            
            if (filledMembers.length < 2) {
                showNotification('ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ø§Ø«Ù†Ø§Ù† Ù…ÙˆØ¸ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„ØªÙŠÙ…', 'warning');
                return;
            }

            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙŠÙ… ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªÙØ§ØµÙŠÙ„
            button.style.display = 'none';
            teamItem.querySelector('.team-details').classList.remove('hidden');
            
            // ØªØ¹Ø·ÙŠÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
            memberInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    input.readOnly = true;
                    input.classList.add('bg-gray-100');
                }
            });
            
            showNotification(`ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­`, 'success');
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¤Ø¬Ù„Ø©
        function togglePostponedNotes() {
            const postponedInput = document.getElementById('postponedMaintenance');
            const postponedNotesSection = document.getElementById('postponedNotesSection');
            const postponedNotes = document.getElementById('postponedNotes');
            
            if (parseInt(postponedInput.value) > 0) {
                postponedNotesSection.classList.remove('hidden');
                postponedNotes.setAttribute('required', 'required');
            } else {
                postponedNotesSection.classList.add('hidden');
                postponedNotes.removeAttribute('required');
                postponedNotes.value = '';
            }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©
        function toggleIncompleteNotes(input) {
            const workItem = input.closest('.work-item');
            const notesDiv = workItem.querySelector('.incomplete-notes');
            const notesTextarea = workItem.querySelector('.maintenance-notes');
            
            if (parseInt(input.value) > 0) {
                notesDiv.classList.remove('hidden');
                notesTextarea.setAttribute('required', 'required');
            } else {
                notesDiv.classList.add('hidden');
                notesTextarea.removeAttribute('required');
                notesTextarea.value = '';
            }
        }
        
        // Ø­Ø°Ù Ø¹Ù†ØµØ± Ø¹Ù…Ù„ (Ù…ÙˆØ¸Ù Ø£Ùˆ ØªÙŠÙ…)
        function removeWorkItem(button) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ')) {
                const workItem = button.closest('.work-item');
                const type = workItem.getAttribute('data-type');
                const name = type === 'employee' ? 
                    workItem.querySelector('.employee-name')?.value || 'Ø§Ù„Ù…ÙˆØ¸Ù' :
                    'Ø§Ù„ØªÙŠÙ…';
                
                workItem.remove();
                showNotification(`ØªÙ… Ø­Ø°Ù ${type === 'employee' ? 'Ø§Ù„Ù…ÙˆØ¸Ù' : 'Ø§Ù„ØªÙŠÙ…'} "${name}" Ø¨Ù†Ø¬Ø§Ø­`, 'warning');
            }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function validateForm() {
            const requiredFields = document.querySelectorAll('.required-field[required]');
            let isValid = true;
            let firstErrorField = null;

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
            document.querySelectorAll('.field-error').forEach(field => {
                field.classList.remove('field-error');
            });

            requiredFields.forEach(field => {
                const value = field.value.trim();
                const isVisible = !field.closest('.hidden');
                
                if (isVisible && (!value || value === '')) {
                    field.classList.add('field-error');
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = field;
                    }
                }
            });

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙŠÙ…Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
            const workItems = document.querySelectorAll('.work-item');
            workItems.forEach(item => {
                const type = item.getAttribute('data-type');
                const isTeamConfirmed = type === 'team' && !item.querySelector('.team-details').classList.contains('hidden');
                const isEmployee = type === 'employee';
                
                if (isEmployee || isTeamConfirmed) {
                    const requiredFieldsInItem = item.querySelectorAll('.required-field[required]');
                    requiredFieldsInItem.forEach(field => {
                        const value = field.value.trim();
                        const isVisible = !field.closest('.hidden');
                        
                        if (isVisible && (!value || value === '')) {
                            field.classList.add('field-error');
                            isValid = false;
                            if (!firstErrorField) {
                                firstErrorField = field;
                            }
                        }
                    });
                }
            });

            if (!isValid && firstErrorField) {
                firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstErrorField.focus();
            }

            return isValid;
        }
        
        // Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        function saveReport() {
            try {
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
                const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
                if (!currentUser) {
                    showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                    window.location.href = 'login.html';
                    return;
                }

                console.log('ğŸ”„ Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...');

                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                if (!validateForm()) {
                    console.error('âŒ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ØºÙŠØ± ØµØ­ÙŠØ­');
                    showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ø¹Ù„Ø§Ù…Ø© (*)', 'error');
                    return;
                }

                const isEditing = editingReportId !== null;
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ù„ÙƒÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                if (isEditing) {
                    const reports = JSON.parse(localStorage.getItem('reports') || '[]');
                    const originalReport = reports.find(r => r.id === editingReportId);
                    if (originalReport && originalReport.userId !== currentUser.id) {
                        showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'error');
                        return;
                    }
                }
                
                showNotification(isEditing ? 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª...' : 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...', 'info', 2000);
                
                const now = new Date().toISOString();
                const reportId = isEditing ? editingReportId : Date.now().toString();
                
                const reportData = {
                    id: reportId,
                    userId: currentUser.id,
                    userEmail: currentUser.email,
                    date: new Date().toISOString().split('T')[0],
                    employee: currentUser.name,
                    createdAt: isEditing ? reports.find(r => r.id === editingReportId)?.createdAt || now : now,
                    updatedAt: isEditing ? now : null,
                    subscriptions: {
                        expiredToday: parseInt(document.getElementById('expiredTodaySubscriptions').value) || 0,
                        active: parseInt(document.getElementById('activeSubscriptions').value) || 0,
                        noAnswer: parseInt(document.getElementById('noAnswerSubscribers').value) || 0,
                        callBackLater: parseInt(document.getElementById('callBackLaterSubscribers').value) || 0
                    },
                    cashZones: {
                        notes: document.getElementById('cashZonesNotes').value || ''
                    },
                    maintenance: {
                        incoming: parseInt(document.getElementById('incomingMaintenance').value) || 0,
                        completed: parseInt(document.getElementById('completedMaintenance').value) || 0,
                        postponed: parseInt(document.getElementById('postponedMaintenance').value) || 0,
                        postponedNotes: document.getElementById('postponedNotes').value || '',
                        generalNotes: document.getElementById('maintenanceGeneralNotes').value || ''
                    },
                    tickets: {
                        incoming: parseInt(document.getElementById('incomingTickets').value) || 0,
                        open: parseInt(document.getElementById('openTickets').value) || 0,
                        notes: document.getElementById('ticketsNotes').value || ''
                    },
                    installations: {
                        incoming: parseInt(document.getElementById('incomingInstallations').value) || 0,
                        completed: parseInt(document.getElementById('completedInstallations').value) || 0,
                        serviceType: document.getElementById('serviceType').value || '',
                        notes: document.getElementById('installationsNotes').value || ''
                    },
                    workItems: Array.from(document.querySelectorAll('.work-item')).map(item => {
                        const type = item.getAttribute('data-type');
                        const baseData = {
                            type: type,
                            maintenanceIncoming: parseInt(item.querySelector('.maintenance-incoming')?.value) || 0,
                            maintenanceCompleted: parseInt(item.querySelector('.maintenance-completed')?.value) || 0,
                            maintenanceIncomplete: parseInt(item.querySelector('.maintenance-incomplete')?.value) || 0,
                            maintenanceNotes: item.querySelector('.maintenance-notes')?.value || '',
                            cablesOutgoingNotes: item.querySelector('.cables-outgoing-notes')?.value || '',
                            cablesIncomingNotes: item.querySelector('.cables-incoming-notes')?.value || ''
                        };

                        if (type === 'employee') {
                            return {
                                ...baseData,
                                name: item.querySelector('.employee-name')?.value || '',
                                rating: item.querySelector('.employee-rating')?.value || ''
                            };
                        } else if (type === 'team') {
                            const members = Array.from(item.querySelectorAll('.member-name'))
                                .map(input => input.value.trim())
                                .filter(name => name !== '');
                            
                            return {
                                ...baseData,
                                members: members,
                                rating: item.querySelector('.team-rating')?.value || ''
                            };
                        }
                    }).filter(item => item && (item.name || item.members))
                };

                console.log('ğŸ“Š Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', reportData);
                console.log('ğŸ’¾ Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ...');

                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
                const reports = JSON.parse(localStorage.getItem('reports') || '[]');
                
                if (isEditing) {
                    console.log('âœï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯:', reportId);
                    
                    // ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    const reportIndex = reports.findIndex(r => r.id === editingReportId);
                    if (reportIndex !== -1) {
                        reports[reportIndex] = reportData;
                    }
                } else {
                    console.log('â• Ø¥Ø¶Ø§ÙØ© ØªÙ‚Ø±ÙŠØ± Ø¬Ø¯ÙŠØ¯:', reportId);
                    
                    // Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    reports.push(reportData);
                }
                
                // Ø­ÙØ¸ ÙÙŠ localStorage
                localStorage.setItem('reports', JSON.stringify(reports));
                
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­ ');
                
                showNotification(
                    isEditing ? 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!' : 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!', 
                    'success'
                );

                editingReportId = null;
                
                // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                clearForm();
                
                 // Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ±
        setTimeout(() => {
            // Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ± ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„ÙŠÙ‡
            localStorage.setItem('lastAddedReportId', reportId);
            window.location.href = 'reports-log.html';
        }, 2000);
        
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
                showNotification(`Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${error.message}`, 'error');
            }
        }
        
        // Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        function clearForm() {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.value = '';
                input.classList.remove('field-error');
            });
            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.value = '';
                textarea.classList.remove('field-error');
            });
            document.querySelectorAll('select').forEach(select => {
                if (select.id !== 'addType' && select.id !== 'departmentSetting' && select.id !== 'darkModeToggle') {
                    select.value = '';
                    select.classList.remove('field-error');
                }
            });
            document.getElementById('workItemsList').innerHTML = '';
            document.getElementById('addType').value = '';
            document.getElementById('postponedNotesSection').classList.add('hidden');
            toggleAddType();
            editingReportId = null;
        }
        
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'success', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'fas fa-check',
                error: 'fas fa-times',
                warning: 'fas fa-exclamation',
                info: 'fas fa-info'
            };

            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="notification-icon">
                        <i class="${icons[type]}"></i>
                    </div>
                    <div class="mr-3 flex-1">
                        <p class="text-sm font-medium text-gray-800">${message}</p>
                    </div>
                    <button onclick="removeNotification(this)" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            `;

            container.appendChild(notification);

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            setTimeout(() => {
                removeNotification(notification);
            }, duration);
        }

        function removeNotification(element) {
            const notification = element.closest ? element.closest('.notification') : element;
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
    </script>
</body>
</html>