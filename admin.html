<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إدارة المستخدمين - نظام التقارير</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        .sidebar-transition {
            transition: all 0.3s ease-in-out;
        }
        
        .sidebar-collapsed .nav-item {
            justify-content: center;
        }
        
        .sidebar-collapsed .nav-item i {
            margin: 0;
        }
        
        .dark {
            --tw-bg-opacity: 1;
            background-color: rgb(17 24 39 / var(--tw-bg-opacity));
            color: white;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        /* نظام الإشعارات */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }

        .notification {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 10px;
            padding: 16px;
            transform: translateX(400px);
            transition: all 0.3s ease-in-out;
            border-left: 4px solid;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: #10b981;
            background: linear-gradient(135deg, 'ecfdf5 0%', 'f0fdf4 100%');
        }

        .notification.error {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, 'fef2f2 0%', 'fef7f7 100%');
        }

        .notification.warning {
            border-left-color: #f59e0b;
            background: linear-gradient(135deg, 'fffbeb 0%', 'fefce8 100%');
        }

        .notification.info {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, 'eff6ff 0%', 'f0f9ff 100%');
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .notification.success .notification-icon {
            background: #10b981;
        }

        .notification.error .notification-icon {
            background: #ef4444;
        }

        .notification.warning .notification-icon {
            background: #f59e0b;
        }

        .notification.info .notification-icon {
            background: #3b82f6;
        }

        /* تنسيق الحقول المطلوبة */
        .required-field {
            border-left: 3px solid #ef4444;
        }

        .field-error {
            border: 2px solid #ef4444 !important;
            background-color: #fef2f2 !important;
        }

        /* أنماط جديدة لقائمة المستخدمين */
        .users-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .user-item {
            transition: all 0.2s ease;
        }
        
        .user-item:hover {
            background-color: #f1f5f9;
        }
        
        .delete-btn {
            transition: all 0.2s ease;
        }
        
        .delete-btn:hover {
            color: #ef4444;
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-300" id="body">
    <!-- حاوية الإشعارات -->
    <div id="notificationContainer" class="notification-container"></div>
    
    <!-- الشريط الجانبي -->
    <div id="sidebar" class="fixed right-0 top-0 h-full w-64 bg-blue-900 text-white shadow-lg sidebar-transition z-50">
        <div class="p-6">
            <div class="flex items-center justify-between mb-8">
                <h2 id="sidebarTitle" class="text-xl font-bold">نظام التقارير</h2>
                <button id="toggleSidebar" class="text-white hover:text-blue-200">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
            
            <nav class="space-y-4">
                <button onclick="showSection('admin')" class="nav-item w-full flex items-center space-x-3 space-x-reverse p-3 rounded-lg bg-blue-800 transition-colors" title="إدارة المستخدمين">
                    <i class="fas fa-users-cog text-xl"></i>
                    <span class="nav-text">إدارة المستخدمين</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div id="main-content" class="mr-64 transition-all duration-300">
        <!-- قسم إدارة المستخدمين -->
        <div id="admin" class="section p-6">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-6">إدارة المستخدمين</h1>
                
                <!-- نموذج إضافة مستخدم جديد -->
                <div class="bg-gray-50 rounded-lg p-6 mb-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                        <i class="fas fa-user-plus ml-2"></i>
                        إضافة مستخدم جديد
                    </h3>
                    
                    <form onsubmit="addUser(event)" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">اسم المستخدم <span class="text-red-500">*</span></label>
                            <input type="text" id="userName" class="w-full p-2 border rounded-lg required-field" placeholder="اسم المستخدم" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">البريد الإلكتروني <span class="text-red-500">*</span></label>
                            <input type="email" id="userEmail" class="w-full p-2 border rounded-lg required-field" placeholder="example@company.com" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">كلمة المرور <span class="text-red-500">*</span></label>
                            <input type="password" id="userPassword" class="w-full p-2 border rounded-lg required-field" placeholder="كلمة المرور" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">القسم <span class="text-red-500">*</span></label>
                            <select id="userDepartment" class="w-full p-2 border rounded-lg required-field" required>
                                <option value="">اختر القسم</option>
                                <option value="متابع صباحي">متابع صباحي</option>
                                <option value="متابع مسائي">متابع مسائي</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2 flex justify-center mt-4">
                            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                <i class="fas fa-plus ml-1"></i>
                                إضافة مستخدم
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- قائمة المستخدمين -->
                <div class="bg-white rounded-lg shadow-md p-6 card-hover">
                    <h3 class="text-lg font-semibold mb-4 text-blue-800 flex items-center">
                        <i class="fas fa-users ml-2"></i>
                        قائمة المستخدمين
                    </h3>
                    
                    <div class="mb-4">
                        <input type="text" id="userSearch" placeholder="ابحث عن مستخدم..." 
                               class="w-full p-2 border rounded-lg" oninput="filterUsers()">
                    </div>
                    
                    <div id="usersList" class="users-list">
                        <!-- سيتم ملء المستخدمين هنا -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // نظام الإشعارات
        function showNotification(message, type = 'success', duration = 4000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: 'fas fa-check',
                error: 'fas fa-times',
                warning: 'fas fa-exclamation',
                info: 'fas fa-info'
            };

            notification.innerHTML = `
                <div class="flex items-start">
                    <div class="notification-icon">
                        <i class="${icons[type]}"></i>
                    </div>
                    <div class="mr-3 flex-1">
                        <p class="text-sm font-medium text-gray-800">${message}</p>
                    </div>
                    <button onclick="removeNotification(this)" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-sm"></i>
                    </button>
                </div>
            `;

            container.appendChild(notification);

            // إظهار الإشعار
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // إخفاء الإشعار تلقائياً
            setTimeout(() => {
                removeNotification(notification);
            }, duration);
        }

        function removeNotification(element) {
            const notification = element.closest ? element.closest('.notification') : element;
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            loadUsers();
        });

        // عرض الأقسام
        function showSection(sectionId) {
            // إخفاء جميع الأقسام
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // إزالة التحديد من جميع عناصر التنقل
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-blue-800');
            });
            
            // عرض القسم المحدد
            document.getElementById(sectionId).classList.remove('hidden');
            
            // تحديد عنصر التنقل النشط
            const navItems = document.querySelectorAll('.nav-item');
            for (let item of navItems) {
                if (item.onclick && item.onclick.toString().includes(sectionId)) {
                    item.classList.add('bg-blue-800');
                    break;
                }
            }
        }

        // إضافة مستخدم جديد
        function addUser(event) {
            event.preventDefault();
            
            const name = document.getElementById('userName').value.trim();
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value;
            const department = document.getElementById('userDepartment').value;
            
            if (!name || !email || !password || !department) {
                showNotification('يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            // التحقق من صحة البريد الإلكتروني
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('يرجى إدخال بريد إلكتروني صحيح', 'error');
                return;
            }
            
            // الحصول على المستخدمين الحاليين
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            
            // التحقق من عدم وجود البريد الإلكتروني مسبقاً
            if (users.some(user => user.email === email)) {
                showNotification('هذا البريد الإلكتروني مسجل مسبقاً', 'error');
                return;
            }
            
            // إضافة المستخدم الجديد
            const newUser = {
                id: Date.now().toString(),
                name: name,
                email: email,
                password: password,
                department: department,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // إعادة تعيين النموذج
            event.target.reset();
            
            // تحديث قائمة المستخدمين
            loadUsers();
            
            showNotification('تم إضافة المستخدم بنجاح', 'success');
        }

        // تحميل المستخدمين
        function loadUsers() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const usersList = document.getElementById('usersList');
            
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-4xl mb-2"></i>
                        <p>لا يوجد مستخدمين مضافين</p>
                    </div>
                `;
                return;
            }
            
            // ترتيب المستخدمين حسب تاريخ الإنشاء (الأحدث أولاً)
            users.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item flex justify-between items-center p-4 border-b border-gray-200';
                userItem.innerHTML = `
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-800">${user.name}</h4>
                        <p class="text-sm text-gray-600">${user.email}</p>
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mt-1">${user.department}</span>
                    </div>
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="editUser('${user.id}')" class="text-blue-500 hover:text-blue-700" title="تعديل">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteUser('${user.id}')" class="text-red-500 hover:text-red-700 delete-btn" title="حذف">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                usersList.appendChild(userItem);
            });
        }

        // تصفية المستخدمين حسب البحث
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const userItems = document.querySelectorAll('#usersList .user-item');
            
            userItems.forEach(item => {
                const userName = item.querySelector('h4').textContent.toLowerCase();
                const userEmail = item.querySelector('p').textContent.toLowerCase();
                
                if (userName.includes(searchTerm) || userEmail.includes(searchTerm)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        }

        // حذف مستخدم
        function deleteUser(userId) {
            if (!confirm('هل أنت متأكد من أنك تريد حذف هذا المستخدم؟ لا يمكن التراجع عن هذا الإجراء.')) {
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const updatedUsers = users.filter(user => user.id !== userId);
            
            localStorage.setItem('users', JSON.stringify(updatedUsers));
            loadUsers();
            
            showNotification('تم حذف المستخدم بنجاح', 'warning');
        }

        // تعديل مستخدم
        function editUser(userId) {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                showNotification('لم يتم العثور على المستخدم', 'error');
                return;
            }
            
            // ملء النموذج ببيانات المستخدم
            document.getElementById('userName').value = user.name;
            document.getElementById('userEmail').value = user.email;
            document.getElementById('userPassword').value = user.password;
            document.getElementById('userDepartment').value = user.department;
            
            showNotification('تم تحميل بيانات المستخدم للتعديل', 'info');
            
            // التمرير إلى أعلى النموذج
            document.getElementById('userName').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>